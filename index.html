<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="/node_modules/tui-time-picker/dist/tui-time-picker.css">
  <link rel="stylesheet" href="/node_modules/tui-date-picker/dist/tui-date-picker.css">
  <link rel="stylesheet" href="/node_modules/tui-grid/dist/tui-grid.css">
  <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">
  <!-- script를 순서대로 가져와야합니다. -->
  <script src="/node_modules/jquery/dist/jquery.min.js"></script>
  <!-- 영상에선 tui-code-snippet까지 추가해주지만 현재 버전에선 없는듯합니다. -->
  <script src="/node_modules/tui-time-picker/dist/tui-time-picker.min.js"></script>
  <script src="/node_modules/tui-date-picker/dist/tui-date-picker.min.js"></script>
  <script src="/node_modules/tui-grid/dist/tui-grid.min.js"></script>
  <!-- <script src="index.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<style>
  * {
    margin: 0 auto;
  }
</style>
<script>
  // window.onload : html 다 실행되고 다음에 실행되게 하기. defer와 같은건가?
  var grid;
  window.onload = function() {
    
    grid = new tui.Grid({
      el: document.getElementById('grid'),
      // data: gridData,
      scrollX: false,
      scrollY: false,
      rowHeaders: ["rowNum"],
      columns: [
        {
          header: 'Id',
          name: 'id',
          editor: 'text'
        },
        {
          header: '이름',
          name: 'name',
          editor: 'text'
        },
        {
          header: '생년월일',
          name: 'birth',
          editor: {
            type: 'datePicker',
            options: {
              format: 'yyyy.MM.dd'
            }
          } 
        },
        {
          header: '은행',
          name: 'bank',
          editor: {
            type: 'select',
            options: {
              listItems: [
                {
                  text: '선택 안함',
                  value: '-'
                },
                {
                  text: '신한',
                  value: '신한'
                },
                {
                  text: 'KB',
                  value: 'KB'
                },
                {
                  text: '하나',
                  value: '하나'
                },
                {
                  text: '외환',
                  value: '외환'
                }
              ]
            }
          }
        },
        {
          header: '계좌',
          name: 'account',
          editor: {
            type: 'text'
          } 
        },
      ],
      draggable: true
    });

    // 버튼 실행
    
    $('#loadInitialButton').click(function(){
      $.ajax({
        url: "initial-data.js",
        method: "GET",
        success: function(result) {
          grid.resetData(eval(result));
        }
      })
    })

    $('#loadDataButton').click(function(){
      $.ajax({
        url: "saved-data.js",
        method: "GET",
        success: function(result) {
          grid.resetData(eval(result));
        }
      })
    })
  }
  // tui.grid 스타일 테마 
  tui.Grid.applyTheme('normal',{
    cell: {
      normal: {
        background: "#fff",
        border: "#e0e0e0",
        showVerticalBorder: false,
        showHorizontalBorder: true,
      },
      header: {
        background: "#e0e0e0",
        border: "#e0e0e0",
        showHorizontalBorder: true,
      },
      rowHeader: {
        background: "#e0e0e0",
        border: "#e0e0e0",
        showHorizontalBorder: true,
      },
    }
  })

  // Function to save data to Excel
  function saveToExcel() {
  const gridData = grid.getColumns().map(column => column.name);
  const rowData = grid.getData().map(row => Object.values(row));

  const dataToExport = [gridData, ...rowData];

  const worksheet = XLSX.utils.aoa_to_sheet(dataToExport);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');

  const wbout = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
  const blob = new Blob([wbout], { type: 'application/octet-stream' });
  const url = URL.createObjectURL(blob);

  const link = document.createElement('a');
  link.setAttribute('href', url);
  link.setAttribute('download', 'grid_data.xlsx');
  link.style.visibility = 'hidden';

  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}


</script>
<body>
  <div id="wrap" style="width: 90%;">
    <div style="display: flex; margin: 10px;">
      <div>
        <button type="button" class="btn btn-primary btn-sm" id="loadInitialButton">입력 시작하기</button>
      </div>
      <div>
        <button type="button" class="btn btn-primary btn-sm" id="loadDataButton">기존 데이터 불러오기</button>
      </div>
      <div>
        <button type="button" class="btn btn-primary btn-sm" id="saveToExcelButton" onclick="saveToExcel() ">엑셀로 저장하기</button>
      </div>
    </div>
    
    <div id="grid"></div>
  </div>
</body>
</html>